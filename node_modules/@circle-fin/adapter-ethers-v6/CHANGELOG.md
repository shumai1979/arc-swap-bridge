# @circle-fin/adapter-ethers-v6

## 1.4.0

### Minor Changes

- Monad chain support added

  Monad mainnet and testnet are now supported for cross-chain USDC transfers. Use `'Monad'` or `'Monad_Testnet'` as chain identifiers in your bridge operations.

## 1.3.0

### Minor Changes

- Add `native.balanceOf` action to query native token balances (ETH, SOL, etc.)
  - Added `NativeActionMap` with `balanceOf` action to check native token balance for any wallet address
  - Added abstract `readNativeBalance(address, chain)` method to base adapters
  - Implemented `readNativeBalance` in all concrete adapters (Viem, Ethers, Solana, SolanaKit)
  - Registered `native.balanceOf` action handlers for EVM and Solana chains
  - Balance reads are gas-free operations returning balance as string (wei for EVM, lamports for Solana)

### Patch Changes

- **Faster balance and allowance checks**: Read-only operations like checking token balances or allowances no longer require wallet network switching. This means no wallet popups asking for permission to switch networks, resulting in quicker responses and a smoother user experience.

## 1.2.0

### Minor Changes

- Clearer ethers factory names eliminate aliasing when using multiple adapters. Prefer `createEthersAdapterFromProvider` and `createEthersAdapterFromPrivateKey` over the deprecated generic `createAdapterFromProvider` and `createAdapterFromPrivateKey`. Existing code works unchanged.

### Patch Changes

- Validation errors now use standardized error codes for consistent error handling. All validation failures return the same `KitError` structure as other SDK errors.

  **Migration:** If you're catching validation errors, update your error handling:
  - Check `error.code === 1098` instead of `instanceof ValidationError`
  - Access details via `error.cause?.trace?.validationErrors` instead of `error.errors`

  The legacy `ValidationError` class remains available for backward compatibility.

- Fixed an issue where custom RPC URLs were not fully respected in Ethers adapter, ensuring users can now properly configure alternative RPC endpoints.
- Fixed unnecessary chain switching in EthersAdapter that was causing redundant provider reconnections and wallet prompts. The adapter now checks the current chain ID before attempting to switch, skipping the operation when already on the target chain. This improves performance for dev-controlled wallets and reduces unnecessary wallet prompts for browser users (MetaMask, WalletConnect, etc.) when performing multiple operations on the same chain.

## 1.1.1

### Patch Changes

- Fixed adapter `getAddress()` types to match function logic by requiring a `chain` parameter, and updated documentation accordingly.
- Improved error handling with more informative and consistent error messages.

  Errors now include:
  - Specific error codes for programmatic handling
  - Error type categorization (BALANCE, ONCHAIN, RPC, NETWORK)
  - Recoverability information (FATAL vs RETRYABLE)
  - Clearer error messages with chain context
  - Original error details preserved for debugging

- Fixed bug where tokens could be burned when bridging to unsupported chains. Bridge operations now fail immediately if the adapter doesn't support the source or destination chain, before any tokens are approved or burned. Error messages now clearly list all supported chains when an unsupported chain is used, and chain validation errors use the correct `INVALID_CHAIN` error code instead of `UNSUPPORTED_ROUTE`.

## 1.1.0

### Minor Changes

- Improves static gas estimate values for contract calls. Updates adapters' `prepare()` method so that transaction simulation is now performed only during `execute()`, not during `estimate()`. Adds an optional fallback parameter to `estimate()` for cases where gas estimation fails.

### Patch Changes

- Fix CommonJS compatibility by correcting file extensions and package exports. This resolves a "ReferenceError: require is not defined" error that occurred when using packages in CommonJS projects with ts-node.

## 1.0.1

### Patch Changes

- Add support for Arc Testnet chain definition. Arc is Circle's EVM-compatible Layer-1 blockchain designed for stablecoin finance and asset
  tokenization, featuring USDC as the native gas token and sub-second finality via the Malachite BFT consensus engine.
- Improve error messages for developer-controlled address contexts. Calling `getAddress()` on an adapter configured with `addressContext: 'developer-controlled'` now throws a clear error explaining that addresses must be provided explicitly in the operation context.
- Update Sonic Testnet chain definition to canonical network. The `SonicTestnet` chain definition now points to the official Sonic Testnet (chainId: 14601) instead of the deprecated Sonic Blaze Testnet (chainId: 57054). The RPC endpoint has been updated to `https://rpc.testnet.soniclabs.com`, the display name simplified to "Sonic Testnet", and the USDC contract address updated to the new deployment.

  **Breaking Changes:**
  - **Chain ID:** 57054 ‚Üí 14601
  - **RPC Endpoint:** `https://rpc.blaze.soniclabs.com` ‚Üí `https://rpc.testnet.soniclabs.com`
  - **USDC Address:** `0xA4879Fed32Ecbef99399e5cbC247E533421C4eC6` ‚Üí `0x0BA304580ee7c9a980CF72e55f5Ed2E9fd30Bc51`

  **Migration:** If you were using `SonicTestnet`, your application will automatically connect to the new network upon upgrading. Any accounts, contracts, or transactions on the old Blaze testnet (chainId: 57054) will need to be recreated on the new testnet.

## 1.0.0

### Major Changes

- # Ethers v6 Adapter 1.0.0 Release üéâ

  Full-featured EVM blockchain adapter built on ethers.js v6 - providing comprehensive support for Ethereum and EVM-compatible chains with familiar ethers.js APIs.

  ## üöÄ Core EVM Features
  - **Complete EVM Support**: Full compatibility with Ethereum and EVM-compatible chains
  - **Ethers.js v6 Integration**: Built on the latest ethers.js with improved performance
  - **Multi-chain Support**: Seamless switching between different EVM networks
  - **Wallet Integration**: Support for various wallet types and signing methods

  ## üîó Supported Networks
  - **Ethereum Mainnet & Testnets**: Full support for Ethereum ecosystem
  - **Layer 2 Solutions**: Optimism, Arbitrum, Polygon, and other L2s
  - **EVM Sidechains**: Base, Avalanche, and other EVM-compatible networks
  - **Custom Networks**: Easy configuration for private or custom EVM chains

  ## üíº Address Management

  **User-Controlled Adapters**
  - Automatic address resolution from connected wallets
  - Support for MetaMask, WalletConnect, and other wallet providers
  - Real-time account switching and network detection

  **Developer-Controlled Adapters**
  - Private key-based signing for server-side applications
  - Deterministic address management for automated systems
  - Secure key handling with ethers.js security practices

  ```typescript
  // User-controlled adapter (wallet-based)
  const adapter = createAdapterFromWallet(wallet)

  // Developer-controlled adapter (private key)
  const adapter = createAdapterFromPrivateKey({
    privateKey: '0x...',
  })
  ```

  ## ‚õΩ Gas Management
  - **Intelligent Gas Estimation**: Automatic gas limit calculation with safety buffers
  - **Dynamic Fee Calculation**: Real-time gas price fetching with configurable buffers
  - **EIP-1559 Support**: Type 2 transaction support for modern fee markets
  - **Gas Optimization**: Efficient transaction batching and optimization

  ## üîê Security Features
  - **Type Safety**: Full TypeScript support with strict type checking
  - **Parameter Validation**: Runtime validation of all transaction parameters
  - **Secure Signing**: Leverages ethers.js battle-tested signing infrastructure
  - **Error Handling**: Comprehensive error handling with detailed error messages

  ## üõ†Ô∏è Developer Experience
  - **Rich JSDoc Documentation**: Complete API documentation with examples
  - **TypeScript First**: Built with TypeScript for superior developer experience
  - **Familiar APIs**: Consistent with ethers.js patterns and conventions
  - **Comprehensive Testing**: Extensive test coverage for reliability

  This adapter provides a robust foundation for EVM-based cross-chain USDC transfers, leveraging the mature ethers.js ecosystem while providing the specialized functionality needed for bridge operations.
